<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/buy.css') }}">

    <title>Buy crypto currencies</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/sweet_alert/login_sweet_alert.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{{ url_for('static', filename='js/sweet_alert/alert_login.js') }}" defer></script>

</head>
<body class="{{ session['theme'] }}" class="modal no-background">
    <script>
        {% if authorize %}
            document.addEventListener("DOMContentLoaded", function() {
            Swal.fire({
                title: 'Success',
                text: '{{ authorize}}',
                icon: 'success',
                confirmButtonText: 'Continue'
            });
        });
        {% endif %}
    </script>
    {% include 'layouts/sidebar.html' %}

    
    {% if modal %}
        {% include 'modal_buy.html' %}
    {% endif %}
    <main class="main">
        <table>
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Name<button class="sort-btn asc"></button></th>    
                    <th onclick="sortTable(1)">Symbol<button class="sort-btn asc"></button></th>
                    <th onclick="sortTable(2)">Price(USD)<button class="sort-btn"></button></th>
                    <th onclick="sortTable(3)">Var(%)<button class="sort-btn asc"></button></th>
                    <th onclick="sortTable(4)">Volume(24h) <button class="sort-btn"></button></th>
                    <th onclick="sortTable(5)">Status<button class="sort-btn asc"></button></th>
                </tr>
            </thead>
            
            <tbody>
                {% for crypto_id, row in session['shop'].items() %}
                <tr 
                {% if row.status %}
                    onclick="window.location.href='/buy/{{ row.name|lower }}';"
                    class="clickable"
                {% endif %}>
                    <td><b>{{ row.name }}</b></td>
                    <td><b>{{ row.symbol }}</b></td>
                    <td><b>{{ "%.2f" | format(row.current_price) }}</b></td>
                    <td class="var-percentage {% if row.price_change_percentage_24h > 0 %}positive{% else %}negative{% endif %}">
                        <b>{{ "%.2f" | format(row.price_change_percentage_24h) }}%</b>
                    </td>
                    <td><b>{{ row.volume_24h }}</b></td>
                    <td class="status {% if row.status %}available{% else %}unavailable{% endif %}">
                        <b>{% if row.status %}Available{% else %}Unavailable{% endif %}</b>
                    </td>
                </tr>
                {% endfor %}
            </tbody>            
        </table>
           

    </main>
</body>
<script>

    function sortTable(columnIndex) {
    const table = document.querySelector("table tbody");
    const rows = Array.from(table.rows);

    // Determina a direção de ordenação inicial com base no índice da coluna
    let sortOrder = "desc"; // Padrão descendente
    if ([0, 1, 5].includes(columnIndex)) { // Colunas 1, 2 e 6 (0, 1 e 5 no índice)
        sortOrder = "asc";
    }

    // Verifica se a coluna já está ordenada, alterna o estado
    const currentBtn = document.querySelectorAll(".sort-btn")[columnIndex];
    if (currentBtn.classList.contains("asc")) {
        sortOrder = "desc";
    } else if (currentBtn.classList.contains("desc")) {
        sortOrder = "asc";
    }

    // Ordena as linhas
    rows.sort((a, b) => {
        const cellA = a.cells[columnIndex].textContent.trim();
        const cellB = b.cells[columnIndex].textContent.trim();

        if (!isNaN(cellA) && !isNaN(cellB)) {
            // Ordenação numérica
            return sortOrder === "asc" ? cellA - cellB : cellB - cellA;
        }

        // Ordenação alfabética
        return sortOrder === "asc"
            ? cellA.localeCompare(cellB)
            : cellB.localeCompare(cellA);
    });

    // Reanexa as linhas ordenadas na tabela
    rows.forEach(row => table.appendChild(row));

    // Atualiza os botões de ordenação
    document.querySelectorAll(".sort-btn").forEach((btn, index) => {
        btn.classList.remove("asc", "desc"); // Remove as classes de todas as colunas
        if (index === columnIndex) {
            btn.classList.add(sortOrder); // Adiciona a classe correspondente à direção
        }
    });
}
    </script>

</html>